<!doctype html>
<!-- Local Variables: mode : html End: -->
<html lang="en">
<head>
<title>CL-USER&gt; (start-up (the engine *bp-ze*))</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- <link href="//fonts.googleapis.com/css?family=Vollkorn:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" />
--> <!-- <link href="//fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" />
--> <link href= "/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<link href= "/css/style.css" rel="stylesheet" type="text/css" />
<link rel="alternate" href="/rss.xml" type="application/rss+xml" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'foo']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body>
<nav class="navigation">
<span class="title"> <a href="/">CL-USER&gt; (start-up (the engine *bp-ze*))</a> </span>
<div class="sitenav"> <span class="sitenav"> <a href="/profile/"><i class="fa fa-user" aria-hidden="true"></i> Profile</a> </span>
<span class="sitenav"> <a href="/publications/"><i class="fa fa-book" aria-hidden="true"></i> Publications</a> </span>
<span class="sitenav"> <a href="http://twitter.com/guicho271828"><i class="fa fa-twitter" aria-hidden="true"></i></a> </span>
<span class="sitenav"> <a href="http://github.com/guicho271828"><i class="fa fa-github" aria-hidden="true"></i></a> </span>
<span class="sitenav"> <a href="https://www.linkedin.com/in/masataro-asai-158a0638/"><i class="fa fa-linkedin" aria-hidden="true"></i></a> </span>
 </div> </nav>
<main id="content">
<!-- Local Variables: mode : html End: -->
<article> <header>
<h1 class="title">Recent Content</h1> </header> <div class="content">
<h1><a href="/posts/ノートパソコンから投稿.html">ノートパソコンから投稿</a></h1>
<div class="date"> posted on 2014-01-05 12:14</div>
<div class="excerpt"><p>ノートパソコンから投稿テスト。
環境は(ほぼ)クリーンインストールな13.10。</p>

<p>ビルドに必要だったのは</p>

<pre><code>sudo apt-get install ruby-dev libxml2-dev libxslt-dev g++
sudo gem install bundler
bundle install
</code></pre>
</div>
</div>
<div class="content">
<h1><a href="/posts/ひさしぶりの更新.html">ひさしぶりの更新</a></h1>
<div class="date"> posted on 2014-01-05 11:36</div>
<div class="excerpt"><p>テスト,テスト,テスト。</p>

</div>
</div>
<div class="content">
<h1><a href="/posts/紹介-ライブラリ-Inner-conditional.html">紹介: ライブラリ Inner-conditional</a></h1>
<div class="date"> posted on 2013-05-06 20:41</div>
<div class="excerpt"><p><a href="https://github.com/guicho271828/inner-conditional" >inner-conditional</a> の紹介をします。</p>

<h1>Q.なにができるの?</h1>

<p>A. ループ(など)の中の条件判定を、内側に書いたままで外側に出せます。</p>

<!-- more -->

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-inner</span></i> <span class="paren2">(<span class="code">body</span>)</span>
    <span class="paren2">(<span class="code">iter <span class="paren3">(<span class="code">for i from 0 to 5</span>)</span>
          <span class="paren3">(<span class="code">print i</span>)</span>
          <span class="paren3">(<span class="code">inner <span class="paren4">(<span class="code">body</span>)</span>
            <span class="paren4">(<span class="code"><i><span class="symbol">if</span></i> flag
                <span class="paren5">(<span class="code">body <span class="paren6">(<span class="code">princ <span class="string">"loop on"</span></span>)</span></span>)</span>
                <span class="paren5">(<span class="code">body <span class="paren6">(<span class="code">princ <span class="string">"loop off"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span></code></pre>

<p>と書くと、</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">IF</span></i> FLAG
    <span class="paren2">(<span class="code"><i><span class="symbol">WITH-INNER</span></i> <span class="paren3">(<span class="code">BODY</span>)</span>
      <span class="paren3">(<span class="code">ITER
        <span class="paren4">(<span class="code">FOR I FROM 0 TO 5</span>)</span>
        <span class="paren4">(<span class="code">PRINT I</span>)</span>
        <span class="paren4">(<span class="code"><i><span class="symbol">PROGN</span></i> <span class="paren5">(<span class="code">PRINC <span class="string">"loop on"</span></span>)</span></span>)</span></span>)</span></span>)</span>
    <span class="paren2">(<span class="code"><i><span class="symbol">WITH-INNER</span></i> <span class="paren3">(<span class="code">BODY</span>)</span>
      <span class="paren3">(<span class="code">ITER
        <span class="paren4">(<span class="code">FOR I FROM 0 TO 5</span>)</span>
        <span class="paren4">(<span class="code">PRINT I</span>)</span>
        <span class="paren4">(<span class="code"><i><span class="symbol">PROGN</span></i> <span class="paren5">(<span class="code">PRINC <span class="string">"loop off"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</span></code></pre>

<p>になって、</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">IF</span></i> FLAG
    <span class="paren2">(<span class="code"><i><span class="symbol">PROGN</span></i>
     <span class="paren3">(<span class="code">ITER
       <span class="paren4">(<span class="code">FOR I FROM 0 TO 5</span>)</span>
       <span class="paren4">(<span class="code">PRINT I</span>)</span>
       <span class="paren4">(<span class="code"><i><span class="symbol">PROGN</span></i> <span class="paren5">(<span class="code">PRINC <span class="string">"loop on"</span></span>)</span></span>)</span></span>)</span></span>)</span>
    <span class="paren2">(<span class="code"><i><span class="symbol">PROGN</span></i>
     <span class="paren3">(<span class="code">ITER
       <span class="paren4">(<span class="code">FOR I FROM 0 TO 5</span>)</span>
       <span class="paren4">(<span class="code">PRINT I</span>)</span>
       <span class="paren4">(<span class="code"><i><span class="symbol">PROGN</span></i> <span class="paren5">(<span class="code">PRINC <span class="string">"loop off"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
</span></code></pre>

<p>になります。うふふ、いいでしょ。キモイ？</p>

<p>この種のループ最適化というと、もとから全て行なってくれるような、とって
も優れた処理系もあるかもしれませんが、なにせ実際に動いているのかどうか
わかりません。(C言語とかって、賢いコンパイラはこういうのが全部デフォルト
で付いているんですかね？) sbclでテストをした結果、 <strong>たしかに</strong> <a href="https://github.com/guicho271828/inner-conditional/blob/master/opt-results.org" >条件判定
の分だけ早くなっていることが確認出来ました。</a></p>

<p>条件判定のタイミングは <code>with-inner</code> の部分ですので、 <code>with-inner</code> をど
こに置くかで判定のタイミングを適切に設定できます。</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-inner</span></i> <span class="paren2">(<span class="code">body</span>)</span>
  <span class="paren2">(<span class="code">iter <span class="paren3">(<span class="code">for i from 0 to 5</span>)</span>
        <span class="paren3">(<span class="code"><i><span class="symbol">with-inner</span></i> <span class="paren4">(<span class="code">body2</span>)</span>
          <span class="paren4">(<span class="code">iter <span class="paren5">(<span class="code">for j from 0 to 5</span>)</span>
                <span class="paren5">(<span class="code">format t <span class="string">"~%i: ~a j: ~a"</span> i j</span>)</span>
                <span class="paren5">(<span class="code">inner <span class="paren6">(<span class="code">body2</span>)</span>
                  <span class="paren6">(<span class="code"><i><span class="symbol">if</span></i> <span class="paren1">(<span class="code">evenp i</span>)</span>
                      <span class="paren1">(<span class="code">body2 <span class="paren2">(<span class="code">format t <span class="string">"  i is even"</span></span>)</span></span>)</span>
                      <span class="paren1">(<span class="code">body2 <span class="paren2">(<span class="code">format t <span class="string">"  i is odd"</span></span>)</span></span>)</span></span>)</span></span>)</span>
                <span class="paren5">(<span class="code">inner-if body flag
                          <span class="paren6">(<span class="code">format t <span class="string">"  loop on"</span></span>)</span>
                          <span class="paren6">(<span class="code">format t <span class="string">"  loop off"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span></code></pre>

<p>この例では、 <code>body</code> レベルでの条件判定は一番上で、一方 <code>body2</code> レベルの
条件判定はループの二段目で行えます。 <code>inner</code> の方、すなわり条件判定の内
容を実際に書いている方で、そのレベルを指定できます。 <code>(inner-if body
...)</code> というのは構文糖で、 <code>(inner (body) (if ... (body ...)))</code> に展開
されるマクロです。ほかにも数種類あります。</p>

<p><code>inner</code> 内で使えるのは <code>if</code> だけじゃありません。 <code>cond</code> でも、 <code>case</code>
でも、オレオレマクロでもなんでも大丈夫です。特殊なマクロで制御構造を登
録する必要はありません。必要なのはこれだけ、すなわち、</p>

<pre><code>継続であるかのように body を呼ぶこと
</code></pre>

<p>です。</p>

<pre><code><span class="code"><span class="paren1">(<span class="code"><i><span class="symbol">with-inner</span></i> <span class="paren2">(<span class="code">body</span>)</span>
  <span class="paren2">(<span class="code">iter
    <span class="paren3">(<span class="code">for i from 0 to 5</span>)</span>
    <span class="paren3">(<span class="code">inner <span class="paren4">(<span class="code">body</span>)</span>
      <span class="paren4">(<span class="code">case <span class="paren5">(<span class="code"><i><span class="symbol">progn</span></i> <span class="paren6">(<span class="code">incf count</span>)</span>
                   <span class="paren6">(<span class="code">mod arg 3</span>)</span></span>)</span>
        <span class="paren5">(<span class="code">0 <span class="paren6">(<span class="code">body <span class="paren1">(<span class="code">format t <span class="string">"divided. i*3 =~a~%"</span>
                         <span class="paren2">(<span class="code">* i 3</span>)</span></span>)</span>
                 <span class="paren1">(<span class="code">format t <span class="string">"divided. i*3 =~a~%"</span>
                         <span class="paren2">(<span class="code">* i 3</span>)</span></span>)</span></span>)</span></span>)</span>
        <span class="paren5">(<span class="code">1 <span class="paren6">(<span class="code">body <span class="paren1">(<span class="code">format t <span class="string">"modulo 1. i*3 + 1 =~a~%"</span>
                         <span class="paren2">(<span class="code">+ 1 <span class="paren3">(<span class="code">* i 3</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span>
        <span class="paren5">(<span class="code">2 <span class="paren6">(<span class="code">body <span class="paren1">(<span class="code">format t <span class="string">"modulo 2. i*3 + 2 =~a~%"</span>
                         <span class="paren2">(<span class="code">+ 2 <span class="paren3">(<span class="code">* i 3</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span></code></pre>

<p>だってほら、全然違いますけど、内側と外側がひっくり返るじゃないですか。
プログラムは実際には <strong>一番最初に</strong> 条件分岐をして、そして <code>inner</code> の中身
が <code>body</code> の引数を代入した状態で実行されるんです。似てませんか？ <strong>継続
に！</strong></p>

<p>続きはまた今度。このライブラリのもうひとつのいいところ、 あなたのライブ
ラリに、 <strong>条件分岐を隠したまま最適化できる能力</strong> を与えられる点について
お話しします。</p>
</div>
</div>
<div class="content">
<h1><a href="/posts/Common-Lisp-で-Code-Walker-を実装するなら-その②.html">Common Lisp で Code Walker を実装するなら その②</a></h1>
<div class="date"> posted on 2013-05-06 15:26</div>
<div class="excerpt"><p>前回の続き。状態を持つmacroletを書くにはどうすればいいのか！？
これが答えだ！</p>

<!-- more -->

<h1>回答: Compile-time で restart-bind</h1>

<p>{% include_code サンプルコード lang:cl walk-tree.lisp %}</p>

<p>ね、面白いでしょ？ANSI Hyperspecにある <code>*macroexpand-hook*</code> をうまく使っ
てみました。 <code>my-macro-start</code> が変な感じになっているのは、ここで書いた
構造が入れ子になってる可能性があるので、スタックフレームをエミュレート
しているんです。 <strong>ん、え、スタック？</strong></p>

<p>Schemerな人は言いたいことがすぐにわかることでしょう。ANSIの設計の何が悪
いって、 <code>defmacro</code> が <strong>継続を引数に取ってくれない</strong> ことなんですよ。だ
から、外側のマクロを展開した時に、内側のマクロ展開を行うときのレキシカ
ル環境を操作できない。それだから中途半端な code-walker しか <em>簡単には</em>
実装できないわけです。</p>

<p>うーん、えーと、もう2,3個思いついたはずなんですけど、思いつかなかった
ので、一つです。なにか他に案がある人はtwitterかgithub経由で教えてくだ
さい(^^)</p>
</div>
</div>
<div class="content">
<h1><a href="/posts/Common-Lisp-で-Code-Walker-を実装するなら.html">Common Lisp で Code Walker を実装するなら</a></h1>
<div class="date"> posted on 2013-05-05 22:01</div>
<div class="excerpt"><p>Common Lispを使っていると、みんな一度はマクロでDSLを実装したくなります
よね。みなさんどうしてるでしょう。例えば、自分の作ったマクロ
<code>my-macro</code> の中では、特定のS式、たとえば=my-clause= に特殊な意味を持つ
節としての役割を与えたい時。マクロは引数のS式を好きに扱えるので、なんで
もありです。だから、例えば。</p>

<!-- more -->

<pre><code>
(defun walk-tree (fn tree)
  (funcall fn tree
           (lambda (branch)
             (mapcar (lambda (branch)
                       (walk-tree fn branch))
                     branch))))

(defun precompile-1-layer (sym fn form)
  (walk-tree
   (lambda (subform cont)
     (if (and (consp subform)
              (equalp sym (car subform)))
         (apply fn (cdr subform))
         (if (consp subform)
             (funcall cont subform)
             subform)))
   form))</code></pre>

<p>みたいなのを定義して、該当シンボルを手動で検知して <code>macroexpand</code> の真似
をする、といった手を使うことができちゃいます。</p>

<pre><code>
(defmacro my-macro (&body body)
  `(progn
     ,@(precompile-1-layer
        'my-clause
        (lambda (&body body)
          (progn (print :hi!)
                 ,@body))
        body)))

(my-macro
 (iter (for i below 5)
       (print i)
       (my-clause
        (print :stupid!))))

;; macroexpansion result

(progn
  (iter (for i below 5)
        (print i)
        (progn
          (print :hi!)
          (print :stupid!))))  
</code></pre>

<p>いやまあ、ここで問題になるのが、 <code>macrolet</code> で指定した内容が全然反映され
ないという事ですね。一言で言えば、頭悪い。</p>

<pre><code>
(my-macro
 (macrolet ((my-clause (&body body)
              (subst :im-not-stupid! :stupid! body)))
   (iter (for i below 5)
         (print i)
         (my-clause
          (print :stupid!)))))
</code></pre>

<pre><code>
(progn
 (macrolet ((my-clause (&body body)
              (subst :im-not-stupid! :stupid! body)))
  (iter (for i below 5)
        (print i)
        (progn
          (print :hi!)
          (print :stupid!)))))
</code></pre>

<p>my-clauseをバイパスして展開してしまっているので、内側のmy-clauseが反映
されず、 <code>:stupid!</code> が <code>:im-not-stupid!</code> に変換されずに残っている。この問
題が、<a href="http://m2ym.github.io/blog/2012/04/28/eval-in-macros/" >m2ymさんも言っている</a> <strong>マクロ内でevalするな</strong> 問題です。</p>

<p>でも、evalしないって辛いです。code walkをするなと言っているのと同様。
じゃあどうすればいいのか。</p>

<h1>全部Macroletに展開する</h1>

<p>これは僕が <a href="https://github.com/guicho271828/inner-conditional" >inner-conditional</a> ではじめに取った手法です。
<code>macrolet</code> をどんどんネストさせるわけです。</p>

<pre><code>
(defmacro my-macro (&body body)
  `(macrolet ((my-clause (&body body)
                `(progn (print :hi!)
                        ,@body)))
     ,@body))
</code></pre>

<p>これで今回のコードでは当面の目標は達成されます。でも、問題が・・・。な
にが問題かというと、コンパイル時に変数を触ることができないということ。
例えば上のコードで、</p>

<pre><code>一回目は〇〇に展開し、二回目は☓☓に展開したい。
</code></pre>

<p>とか、</p>

<pre><code>i回目にはiを用いて … に展開したい。その指定は実行時ではダメで、
コンパイル時に定数として挿入したい。
</code></pre>

<p>とかいう需要があるときにどうするか。</p>

<p><code>macrolet</code> はスペシャルフォームなので、そのマクロ定義だけをletで囲む
なんてことはできません。出来れば嬉しいんだけれどねえ…</p>

<pre><code>
(macrolet ((let ((i 0))
             (my-clause (&body body)
                (incf i)
                `(progn (print ,i)
                        ,@body))))
  (do-something))
</code></pre>

<p>ではどうするか。例を示そうと思ったんですが、例を書くだけでも骨が折れる
ようなコードだったので、続きは次の記事で。</p>
</div>
</div>
<div class="content">
<h1><a href="/posts/ロードスター用のROMエディタ.html">ロードスター用のROMエディタ</a></h1>
<div class="date"> posted on 2013-04-06 01:25</div>
<div class="excerpt"><p>そういえば、ブログを作ったのに
ROMエディタをアップロードしてなかったので、
公開しておきます。</p>

</div>
</div>
<div class="content">
<h1><a href="/posts/Arduinoで環境づくり.html">Arduinoで環境づくり</a></h1>
<div class="date"> posted on 2013-04-05 17:59</div>
<div class="excerpt"><p>Arduinoボードを買いました。
お金ないのに・・・でも部のためなら仕方ない。</p>

</div>
</div>
<div class="content">
<h1><a href="/posts/オレオレlisp入門.html">オレオレlisp入門</a></h1>
<div class="date"> posted on 2013-03-28 18:03</div>
<div class="excerpt"><p>Lispでプログラミングをはじめるには何をすればいいのか、まさに直接的な
チュートリアルをつくろうと思い立ち、この記事を書き始めました。</p>

<p>古いし読むに耐えない記事なので削除! (2016/3/30)</p>
</div>
</div>
<div class="content">
<h1><a href="/posts/最新版のOrg-mode-80-previewをOctopressと連携させる.html">最新版のOrg-mode (8.0 preview)をOctopressと連携させる</a></h1>
<div class="date"> posted on 2013-03-28 13:15</div>
<div class="excerpt"><p>たぶんこれでいけた。.emacsを編集して、かつRakefileをちょこっと変更する
だけ。基本方針は、File local variables を使って、ファイルを保存すると同
時にorg-modeからmarkdownに変換する。orgのファイルは
<code>$octopress-root$/org/</code> に入れる。そしたら
<code>$octopress-root$/source/_posts</code> にmdファイルが移る。</p>

<!-- more -->

<p>Octopressでのブログ生成をEmacsからコマンド一発( <code>M-x octopost</code> など)でやれ
るようになっている。いちいちシェルを開くのもめんどくさい。正直、この程
度だとrakeの必要性がないというか、Emacs Lispとやれることが被ってるんだ
よね。依存関係とか無いし。しかも <code>rake new_post[title]</code> は作ったファイ
ル名を返してくれない。結局、作ったファイルを自動で開くようにするのは面
倒くさくてやらなかった。ただ、一応、フォルダを開くことにはしておいた。
また、 <code>rake preview</code> コマンドをバックグラウンドで自動で起動してくれる。
ただし、起動したバッファを自分で消さないとだめ。</p>

<p>最後に(ここまでする必要あるか？)、 <code>M-x gen-dep</code> で <code>rake gen_deploy</code> 相
当のものができる。</p>

<pre><code>(defvar octopress-repo &quot;~/repos/octopress/&quot;) ;; このアドレスは自由に変更可能
(defvar posts &quot;source/_posts/&quot;)
(defvar org-source &quot;org/&quot;)
(defvar octopress-export-org-to-md-enabled nil)
(defun org-md-try-to-export-to-markdown ()
  (interactive)
  (when octopress-export-org-to-md-enabled
    (let ((md (org-md-export-to-markdown)))
      (shell-command 
       (format &quot;mv -f %s %s&quot; 
               md (concatenate 'string octopress-repo posts))))))

(defun octopost (title)
  (interactive &quot;sInput the new post title: &quot;)
  (shell-command
   (format &quot;cd %s;rake new_post[\&quot;%s\&quot;]&quot; octopress-repo title))
  (octo-preview)
  (find-file (concatenate 'string octopress-repo org-source)))

(defun octopage (title)
  (interactive &quot;sInput the new page title: &quot;)
  (shell-command
   (format &quot;cd %s;rake new_page[\&quot;%s\&quot;]&quot; octopress-repo title))
  (octo-preview)
  (find-file (concatenate 'string octopress-repo org-source)))

(defun octo-preview ()
  (interactive)
  (shell-command
     (format &quot;cd %s;rake preview &amp;&quot; octopress-repo)))
(defun gen-dep ()
  (interactive)
  (shell-command
   (format &quot;cd %s;rake gen_deploy &amp;&quot; octopress-repo)
   (get-buffer-create &quot;*Async Shell Command*&quot;))
  (sleep-for 5)
  (kill-buffer &quot;*Async Shell Command*&quot;))

(add-hook 'after-save-hook #'org-md-try-to-export-to-markdown)
</code></pre>

<p>それで、それぞれのファイルの先頭に以下のように書く。</p>

<pre><code># -*- octopress-export-org-to-md-enabled : t -*-
</code></pre>

<p>もちろんそれは面倒臭い。なので、Rakefileで指定する。
変更点はざっとこんな感じ。
一部は <a href="http://blog.paphus.com/blog/2012/08/01/introducing-octopress-blogging-for-org-mode/" >Introducing Octopress Blogging for Org-Mode</a> を参考にした。</p>

<pre><code>diff --git a/Rakefile b/Rakefile
index d3a1cb0..827ebfe 100644
--- a/Rakefile
+++ b/Rakefile
@@ -23,8 +23,9 @@ deploy_dir      = &quot;_deploy&quot;   # deploy directory (for Github pages deployment)
 stash_dir       = &quot;_stash&quot;    # directory to stash posts for speedy generation
 posts_dir       = &quot;_posts&quot;    # directory for blog files
 themes_dir      = &quot;.themes&quot;   # directory for blog files
-new_post_ext    = &quot;markdown&quot;  # default new post file extension when using the new_post task
-new_page_ext    = &quot;markdown&quot;  # default new page file extension when using the new_page task
+org_posts_dir   = &quot;org&quot;
+new_post_ext    = &quot;org&quot;  # default new post file extension when using the new_post task
+new_page_ext    = &quot;org&quot;  # default new page file extension when using the new_page task
 server_port     = &quot;4000&quot;      # port for preview server eg. localhost:4000


@@ -98,13 +99,17 @@ task :new_post, :title do |t, args|
     title = get_stdin(&quot;Enter a title for your post: &quot;)
   end
   raise &quot;### You haven't set anything up yet. First run `rake install` to set up an Octopress theme.&quot; unless File.directory?(source_dir)
-  mkdir_p &quot;#{source_dir}/#{posts_dir}&quot;
-  filename = &quot;#{source_dir}/#{posts_dir}/#{Time.now.strftime('%Y-%m-%d')}-#{title.to_url}.#{new_post_ext}&quot;
+  mkdir_p &quot;#{org_posts_dir}&quot;
+  filename = &quot;#{org_posts_dir}/#{Time.now.strftime('%Y-%m-%d')}-#{title.to_url}.#{new_post_ext}&quot;
   if File.exist?(filename)
     abort(&quot;rake aborted!&quot;) if ask(&quot;#{filename} already exists. Do you want to overwrite?&quot;, ['y', 'n']) == 'n'
   end
   puts &quot;Creating new post: #{filename}&quot;
   open(filename, 'w') do |post|
+    post.puts &quot;# -*- octopress-export-org-to-md-enabled : t -*-&quot;
+    post.puts &quot;#+title: #{title.gsub(/&amp;/,'&amp;amp;')}&quot;
+    post.puts &quot;#+date: #{Time.now.strftime('%Y-%m-%d %H:%M')}&quot;
+    post.puts &quot;#+begin_MD&quot;
     post.puts &quot;---&quot;
     post.puts &quot;&quot;
     post.puts &quot;title: \&quot;#{title.gsub(/&amp;/,'&amp;amp;')}\&quot;&quot;
@@ -112,6 +117,7 @@ task :new_post, :title do |t, args|
     post.puts &quot;&quot;
     post.puts &quot;&quot;
     post.puts &quot;---&quot;
+    post.puts &quot;#+end_MD&quot;
   end
 end

@@ -140,6 +146,9 @@ task :new_page, :filename do |t, args|
     end
     puts &quot;Creating new page: #{file}&quot;
     open(file, 'w') do |page|
+      page.puts &quot;#+title: #{title}&quot;
+      page.puts &quot;#+date: #{Time.now.strftime('%Y-%m-%d %H:%M')}&quot;
+      page.puts &quot;#+begin_MD&quot;
       page.puts &quot;---&quot;
       page.puts &quot;layout: page&quot;
       page.puts &quot;title: \&quot;#{title}\&quot;&quot;
@@ -148,6 +157,7 @@ task :new_page, :filename do |t, args|
       page.puts &quot;sharing: true&quot;
       page.puts &quot;footer: true&quot;
       page.puts &quot;---&quot;
+      page.puts &quot;#+end_MD&quot;
     end
</code></pre>

<p>とにかく動けばいいやって感じのhackだけど、まあこれでいいでしょ。快適だ
し、わざわざファイル名を変えたりコピーしなくていいし。</p>

<p>注意点。org-modeはgitで取得した最新版(8.0-pre)。旧来のexporterが使えな
くなっているので注意。exportのメニュー画面がだいぶ変更されている。雑然
としていたいままでのexport画面が改良されているのはいい感じだな。
そもそも、今回のこれをやり始めたきっかけは、 <code>org-mode</code> を新しくしたら
 <a href="https://github.com/alexhenning/ORGMODE-Markdown" >orgmode-markdown</a> が使えなくなっていたこと。その主な理由は、
<code>orgmode-markdown</code> の依存している <code>org-export-generic</code> が、最新版では
消去されているから。どうやら、一度oldextフォルダに移されて、しばらくし
たらその全体が消されたようだ。</p>

<p>さて、次の記事は卒論からポートしてきた <code>CL-RRT</code> か、それとも Yet
Another オレオレLisp入門かな…。</p>
</div>
</div>
<div class="content">
<h1><a href="/posts/UTAC-leaflet.html">UTAC leaflet</a></h1>
<div class="date"> posted on 2013-03-14 10:57</div>
<div class="excerpt"><p>自動車部のポスターを作りました。
製作時間はまる一日。ソフトウェアはもちろんGIMP。</p>

</div>
</div>
 <article> <nav>
<div id="relative-nav"> <a href="/3.html">Previous</a> <a href="/1.html">Next</a> </div>
<div id="tagsoup"> This blog covers <a href="/tag/arduino.html">arduino</a>, <a href="/tag/bar.html">bar</a>, <a href="/tag/baz.html">baz</a>, <a href="/tag/car.html">car</a>, <a href="/tag/lisp.html">lisp</a>, <a href="/tag/octopress.html">octopress</a>, <a href="/tag/old-blog.html">old-blog</a>, <a href="/tag/research.html">research</a> </div>
 <div id="monthsoup"> View content from <a href="/date/2017-11.html">2017-11</a>, <a href="/date/2015-01.html">2015-01</a>, <a href="/date/2014-05.html">2014-05</a>, <a href="/date/2014-03.html">2014-03</a>, <a href="/date/2014-01.html">2014-01</a>, <a href="/date/2013-05.html">2013-05</a>, <a href="/date/2013-04.html">2013-04</a>, <a href="/date/2013-03.html">2013-03</a> </div>
</nav> </main>

<footer class="fineprint"> Unless otherwise credited all material <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"> <img alt="Creative Commons License" style="border-width:0" src="/css/cc-by-sa.png" /> </a> by Masataro Asai <a id="coleslaw-logo" href="https://github.com/redline6561/coleslaw"> <img src="/css/logo_small.jpg" alt="Coleslaw logo" /> </a> </footer>
</body>
</html>